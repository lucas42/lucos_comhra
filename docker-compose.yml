services:
  llm:
    build:
      context: ./llm
    container_name: lucos_comhra_llm
    image: lucas42/lucos_comhra_llm
    volumes:
      - ollama_data:/root/.ollama
    environment:
      - OLLAMA_MODEL=lucos-llama3.2-3b
      - OLLAMA_MAX_LOADED_MODELS=1
      - OLLAMA_NUM_PARALLEL=1
      - OLLAMA_MAX_QUEUE=2
    mem_limit: 4g
    memswap_limit: 4g
    cpus: "1.5"
    oom_score_adj: 500

  agent:
    build: ./agent
    container_name: lucos_comhra_agent
    image: lucas42/lucos_comhra_agent
    environment:
      - PORT
      - SYSTEM
      - ARACHNE_ENDPOINT
      - KEY_LUCOS_ARACHNE
      - OLLAMA_URL=http://llm:11434
      - OLLAMA_MODEL=lucos-llama3.2-3b
    ports:
      - "${PORT}:${PORT}"
    depends_on:
      - llm

volumes:
  ollama_data:
